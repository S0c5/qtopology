<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="638px" preserveAspectRatio="none" style="width:635px;height:638px;" version="1.1" viewBox="0 0 635 638" width="635px" zoomAndPan="magnify"><defs><filter height="300%" id="fh7su4v" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fh7su4v)" height="533.8594" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="36.5" y="48.2969"/><rect fill="#FFFFFF" filter="url(#fh7su4v)" height="71.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="416.5" y="69.2969"/><rect fill="#FFFFFF" filter="url(#fh7su4v)" height="156.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="416.5" y="169.6953"/><rect fill="#FFFFFF" filter="url(#fh7su4v)" height="226.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="416.5" y="355.3594"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="41" x2="41" y1="38.2969" y2="600.1563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="421.5" x2="421.5" y1="38.2969" y2="600.1563"/><rect fill="#FEFECE" filter="url(#fh7su4v)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="63" x="8" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="15" y="22.9951">Worker</text><rect fill="#FEFECE" filter="url(#fh7su4v)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="63" x="8" y="599.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="15" y="619.1514">Worker</text><rect fill="#FEFECE" filter="url(#fh7su4v)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="385.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="392.5" y="22.9951">Storage</text><rect fill="#FEFECE" filter="url(#fh7su4v)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="385.5" y="599.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="392.5" y="619.1514">Storage</text><rect fill="#FFFFFF" filter="url(#fh7su4v)" height="533.8594" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="36.5" y="48.2969"/><rect fill="#FFFFFF" filter="url(#fh7su4v)" height="71.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="416.5" y="69.2969"/><rect fill="#FFFFFF" filter="url(#fh7su4v)" height="156.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="416.5" y="169.6953"/><rect fill="#FFFFFF" filter="url(#fh7su4v)" height="226.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="416.5" y="355.3594"/><polygon fill="#A80036" points="404.5,65.2969,414.5,69.2969,404.5,73.2969,408.5,69.2969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46.5" x2="410.5" y1="69.2969" y2="69.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="53.5" y="64.3638">checkLeadershipStatus</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="426.5" x2="468.5" y1="113.6953" y2="113.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="468.5" x2="468.5" y1="113.6953" y2="126.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="427.5" x2="468.5" y1="126.6953" y2="126.6953"/><polygon fill="#A80036" points="437.5,122.6953,427.5,126.6953,437.5,130.6953,433.5,126.6953" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="433.5" y="93.4966">check current leadership status</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="433.5" y="108.6294">Disable leader if timeout</text><polygon fill="#A80036" points="57.5,136.6953,47.5,140.6953,57.5,144.6953,53.5,140.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="51.5" x2="420.5" y1="140.6953" y2="140.6953"/><polygon fill="#A80036" points="404.5,165.6953,414.5,169.6953,404.5,173.6953,408.5,169.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46.5" x2="410.5" y1="169.6953" y2="169.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="252" x="53.5" y="164.7622">(if no leader) sendLeadershipCandidacy</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="426.5" x2="468.5" y1="198.9609" y2="198.9609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="468.5" x2="468.5" y1="198.9609" y2="211.9609"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="427.5" x2="468.5" y1="211.9609" y2="211.9609"/><polygon fill="#A80036" points="437.5,207.9609,427.5,211.9609,437.5,215.9609,433.5,211.9609" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="433.5" y="193.895">mark new candidate</text><polygon fill="#A80036" points="57.5,221.9609,47.5,225.9609,57.5,229.9609,53.5,225.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="51.5" x2="415.5" y1="225.9609" y2="225.9609"/><polygon fill="#A80036" points="404.5,250.9609,414.5,254.9609,404.5,258.9609,408.5,254.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46.5" x2="410.5" y1="254.9609" y2="254.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="53.5" y="250.0278">checkCandidacy</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="426.5" x2="468.5" y1="284.2266" y2="284.2266"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="468.5" x2="468.5" y1="284.2266" y2="297.2266"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="427.5" x2="468.5" y1="297.2266" y2="297.2266"/><polygon fill="#A80036" points="437.5,293.2266,427.5,297.2266,437.5,301.2266,433.5,297.2266" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="433.5" y="279.1606">mark new leader if success</text><polygon fill="#A80036" points="57.5,322.2266,47.5,326.2266,57.5,330.2266,53.5,326.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="51.5" x2="420.5" y1="326.2266" y2="326.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="63.5" y="321.2935">status if candidacy was successfull</text><polygon fill="#A80036" points="404.5,351.3594,414.5,355.3594,404.5,359.3594,408.5,355.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46.5" x2="410.5" y1="355.3594" y2="355.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="53.5" y="350.4263">(if leader) getWorkerStatuses</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="426.5" x2="468.5" y1="384.625" y2="384.625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="468.5" x2="468.5" y1="384.625" y2="397.625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="427.5" x2="468.5" y1="397.625" y2="397.625"/><polygon fill="#A80036" points="437.5,393.625,427.5,397.625,437.5,401.625,433.5,397.625" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="433.5" y="379.5591">collect worker statuses</text><polygon fill="#A80036" points="57.5,407.625,47.5,411.625,57.5,415.625,53.5,411.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="51.5" x2="415.5" y1="411.625" y2="411.625"/><polygon fill="#A80036" points="404.5,436.625,414.5,440.625,404.5,444.625,408.5,440.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46.5" x2="410.5" y1="440.625" y2="440.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="346" x="53.5" y="435.6919">setTopologyStatus (to unassigned if worker timed out)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="426.5" x2="468.5" y1="469.8906" y2="469.8906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="468.5" x2="468.5" y1="469.8906" y2="482.8906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="427.5" x2="468.5" y1="482.8906" y2="482.8906"/><polygon fill="#A80036" points="437.5,478.8906,427.5,482.8906,437.5,486.8906,433.5,482.8906" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="433.5" y="464.8247">update worker statuses</text><polygon fill="#A80036" points="57.5,492.8906,47.5,496.8906,57.5,500.8906,53.5,496.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="51.5" x2="415.5" y1="496.8906" y2="496.8906"/><polygon fill="#A80036" points="404.5,521.8906,414.5,525.8906,404.5,529.8906,408.5,525.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="46.5" x2="410.5" y1="525.8906" y2="525.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="53.5" y="520.9575">updateWorkerStatus (if timed out)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="426.5" x2="468.5" y1="555.1563" y2="555.1563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="468.5" x2="468.5" y1="555.1563" y2="568.1563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="427.5" x2="468.5" y1="568.1563" y2="568.1563"/><polygon fill="#A80036" points="437.5,564.1563,427.5,568.1563,437.5,572.1563,433.5,568.1563" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="433.5" y="550.0903">update worker statuses</text><polygon fill="#A80036" points="52.5,578.1563,42.5,582.1563,52.5,586.1563,48.5,582.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="46.5" x2="420.5" y1="582.1563" y2="582.1563"/><!--
@startuml
activate Worker
Worker -> Storage: checkLeadershipStatus
activate Storage
Storage -> Storage: check current leadership status\nDisable leader if timeout
Storage - -> Worker:
deactivate Storage

Worker->Storage: (if no leader) sendLeadershipCandidacy
activate Storage
Storage->Storage: mark new candidate
Storage- ->Worker:

Worker -> Storage: checkCandidacy
Storage -> Storage: mark new leader if success
Storage - -> Worker: status if candidacy was successfull
deactivate Storage

Worker -> Storage: (if leader) getWorkerStatuses
activate Storage
Storage -> Storage: collect worker statuses
Storage - -> Worker:

Worker -> Storage: setTopologyStatus (to unassigned if worker timed out)
Storage -> Storage: update worker statuses
Storage - -> Worker:

Worker -> Storage: updateWorkerStatus (if timed out)
Storage -> Storage: update worker statuses
Storage - -> Worker:

deactivate Storage

deactivate Worker
@enduml

PlantUML version 2017.09(Wed Apr 05 16:07:11 UTC 2017)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.7.0_25-b15
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>