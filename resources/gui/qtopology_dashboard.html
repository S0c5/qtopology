<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="qtopology_dashboard.css" />
    <script src="qtopology_dashboard.js"></script>
    <script src="d3.min.js"></script>
    <script src="jquery-2.2.0.min.js"></script>
    <script src="knockout-3.4.0.js"></script>
</head>

<body>
    <div class="header">
        <img src="logo.png" alt="logo" class="logo" />
        <h1>QTopology dashboard</h1>
    </div>
    <div id="bladeWorker" class="blade">
        <div class="blade-content" data-bind="with: selected_worker">
            <span class="blade-close">&times;</span>
            <h1>Worker info</h1>
            <div>
                <div class="cell-4">
                    <div class="panel">
                        <div class="panel-header">
                            <div class="title">Properties</div>
                        </div>
                        <div class="panel-body props">

                            <dt>Name</dt>
                            <dd data-bind="text: name()"></dd>

                            <dt>Status</dt>
                            <dd>
                                <span class="badge badge-green" data-bind="visible: status()=='alive'">Alive</span>
                                <span class="badge badge-red" data-bind="visible: status()=='dead'">Dead</span>
                                <span class="badge badge-orange" data-bind="visible: status()=='closing'">Closing</span>
                                <span class="badge" data-bind="visible: status()=='unloaded'">Unloaded</span>
                            </dd>

                            <dt>Status updated</dt>
                            <dd data-bind="text: last_ping()"></dd>

                            <dt>Leadership status</dt>
                            <dd>
                                <span class="badge badge-gold" data-bind="visible: lstatus()=='leader'">Leader</span>
                                <span class="badge" data-bind="visible: lstatus()!='leader'">Normal</span>
                            </dd>

                            <div class="action-panel" data-bind="visible: status() == 'alive'">
                                <div class="action-title">
                                    Shut down
                                </div>
                                <div class="action-desc">
                                    Shuts down this worker. You have to have a mechanism to bring it up again, as it cannot be done via this dashboard.
                                </div>
                                <div class="action-btn">
                                    <button data-bind="click: shut_down">Shutdown</button>
                                </div>
                            </div>

                            <div class="action-panel" data-bind="visible: status() == 'unloaded'">
                                <div class="action-title">
                                    Delete worker
                                </div>
                                <div class="action-desc">
                                    If this worker record is obsolete, you can delete it from the list of workers.
                                </div>
                                <div class="action-btn">
                                    <button data-bind="click: remove">Delete</button>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="cell-8">
                    <div class="panel">
                        <div class="panel-header">
                            <div class="title">Topologies</div>
                        </div>
                        <div class="panel-body">
                            <div data-bind="foreach: topologies">
                                <div class="ticket">
                                    <div class="ticket-inner">
                                        <div class="pull-right">
                                            <!-- Enabled/diabled badge -->
                                            <span class="badge badge-green" data-bind="visible: enabled()==true">Enabled</span>
                                            <span class="badge " data-bind="visible: enabled()==false">Disabled</span>
                                            <!--Status badge-->
                                            <span class="badge badge-green" data-bind="visible: status()=='running'">Running</span>
                                            <span class="badge badge-red" data-bind="visible: status()=='error'">Error</span>
                                            <span class="badge" data-bind="visible: status()=='unloaded'">Unloaded</span>
                                            <span class="badge badge-orange" data-bind="visible: status()=='waiting'">Waiting</span>
                                        </div>
                                        <label data-bind="text: uuid()"></label>
                                        <div>
                                            worker: <span data-bind="text: worker()"></span>
                                        </div>
                                        <div class="right">
                                            <a data-bind="click: open">More &raquo;</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="panel">
                        <div class="panel-header">
                            <div class="title">History</div>
                        </div>
                        <div class="panel-body">
                            <table>
                                <thead>
                                    <tr>
                                        <th>When</th>
                                        <th>Status</th>
                                        <th>Leadership</th>
                                    </tr>
                                </thead>
                                <tbody data-bind="foreach: history">
                                    <tr>
                                        <td data-bind="text: ts_s"></td>
                                        <td>
                                            <span class="badge badge-green" data-bind="visible: status=='alive'">Alive</span>
                                            <span class="badge badge-red" data-bind="visible: status=='dead'">Dead</span>
                                            <span class="badge badge-orange" data-bind="visible: status=='closing'">Closing</span>
                                            <span class="badge" data-bind="visible: status=='unloaded'">Unloaded</span>
                                        </td>
                                        <td>
                                            <span class="badge badge-gold" data-bind="visible: lstatus=='leader'">Leader</span>
                                            <span class="badge" data-bind="visible: lstatus!='leader'">Normal</span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div id="bladeTopology" class="blade">
        <div class="blade-content" data-bind="with: selected_topology">
            <span class="blade-close">&times;</span>
            <h1>Topology info</h1>
            <div class="cell-3">
                <div class="panel">
                    <div class="panel-header">
                        <div class="title">Properties</div>
                    </div>
                    <div class="panel-body">
                        <div class="props">

                            <dt>UUID</dt>
                            <dd data-bind="text: uuid()"></dd>

                            <dt>Enabled</dt>
                            <dd>
                                <span class="badge badge-green" data-bind="visible: enabled()==true">Enabled</span>
                                <span class="badge " data-bind="visible: enabled()==false">Disabled</span>
                            </dd>

                            <dt>Status</dt>
                            <dd>
                                <span class="badge badge-green" data-bind="visible: status()=='running'">Running</span>
                                <span class="badge badge-red" data-bind="visible: status()=='error'">Error</span>
                                <span class="badge" data-bind="visible: status()=='unassigned'">Unassigned</span>
                                <span class="badge badge-orange" data-bind="visible: status()=='waiting'">Waiting</span>
                            </dd>

                            <dt>Worker</dt>
                            <dd data-bind="text: worker()"></dd>
                            <dt>Error</dt>
                            <dd data-bind="text: error()"></dd>

                            <div class="action-panel" data-bind="visible: enabled() == true">
                                <div class="action-title">
                                    Disable
                                </div>
                                <div class="action-desc">
                                    <p>
                                        Click the button to mark the topology as disabled. This will prevent it from running again.
                                    </p>
                                    <p>
                                        It will not stop it, if it is currently running.
                                    </p>
                                </div>
                                <div class="action-btn">
                                    <button data-bind="click: set_disabled">Disable</button>
                                </div>
                            </div>

                            <div class="action-panel" data-bind="visible: enabled() == false">
                                <div class="action-title">
                                    Enable
                                </div>
                                <div class="action-desc">
                                    Click the button to mark the topology as enabled. This will make it available to workers and one of them pick should it up
                                    very soon, if there is at least one worker running.
                                </div>
                                <div class="action-btn">
                                    <button data-bind="click: set_enabled">Enable</button>
                                </div>
                            </div>

                            <div class="action-panel" data-bind="visible: enabled() == true && status() == 'error'">
                                <div class="action-title">
                                    Clear the error
                                </div>
                                <div class="action-desc">
                                    This topology was marked with error. Clear the error tag to make it start running again.
                                </div>
                                <div class="action-btn">
                                    <button data-bind="click: clear_error">Clear error</button>
                                </div>
                            </div>

                            <div class="action-panel" data-bind="visible: status() == 'running'">
                                <div class="action-title">
                                    Stop this topology
                                </div>
                                <div class="action-desc">
                                    <p>
                                        Send STOP signal to the worker that is running this topology. If topology is marked as enabled, it will be assigned again,
                                        possibly to another worker.
                                    </p>
                                    <p>
                                        Mark it as disabled first if you don't want it to run anymore.
                                    </p>
                                </div>
                                <div class="action-btn">
                                    <button data-bind="click: stop">Stop topology</button>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="cell-9">
                <div class="panel">
                    <div class="panel-header">
                        <div class="title">Run-time info</div>
                    </div>
                    <div class="panel-body">
                    </div>
                </div>
                <div class="panel">
                    <div class="panel-header">
                        <div class="title">Configuration</div>
                    </div>
                    <div class="panel-body">
                        <pre data-bind="text: JSON.stringify(config(), null, 4)">
                        </pre>
                    </div>
                </div>
                <div class="panel">
                    <div class="panel-header">
                        <div class="title">History</div>
                    </div>
                    <div class="panel-body">
                        <table>
                            <thead>
                                <tr>
                                    <th>When</th>
                                    <th>Enabled</th>
                                    <th>Status</th>
                                    <th>Worker</th>
                                    <th>Error</th>
                                </tr>
                            </thead>
                            <tbody data-bind="foreach: history">
                                <tr>
                                    <td data-bind="text: ts_s"></td>
                                    <td>
                                        <span class="badge badge-green" data-bind="visible: enabled==true">Enabled</span>
                                        <span class="badge " data-bind="visible: enabled==false">Disabled</span>
                                    </td>
                                    <td>
                                        <span class="badge badge-green" data-bind="visible: status=='running'">Running</span>
                                        <span class="badge badge-red" data-bind="visible: status=='error'">Error</span>
                                        <span class="badge" data-bind="visible: status=='unassigned'">Unassigned</span>
                                        <span class="badge badge-orange" data-bind="visible: status=='waiting'">Waiting</span>
                                    </td>
                                    <td data-bind="text: worker"></td>
                                    <td data-bind="text: error"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="content">
        <div class="cell-4">
            <div class="panel">
                <div class="panel-header">
                    <div class="title">Workers</div>
                </div>
                <div class="panel-body">
                    <div data-bind="foreach: workers">
                        <div class="ticket">
                            <div class="ticket-inner">
                                <div class="pull-right">
                                    <span class="badge badge-gold" data-bind="visible: lstatus()=='leader'">Leader</span>

                                    <span class="badge badge-green" data-bind="visible: status()=='alive'">Alive</span>
                                    <span class="badge badge-red" data-bind="visible: status()=='dead'">Dead</span>
                                    <span class="badge badge-orange" data-bind="visible: status()=='closing'">Closing</span>
                                    <span class="badge" data-bind="visible: status()=='unloaded'">Unloaded</span>
                                </div>
                                <label data-bind="text: name()"></label>
                                <div>
                                    topologies: <span data-bind="text: topologies_count()"></span>
                                </div>
                                <div class="right">
                                    <a data-bind="click: open">More &raquo;</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="cell-5">
            <div class="panel">
                <div class="panel-header">
                    <div class="title">Topologies</div>
                </div>
                <div class="panel-body">
                    <div data-bind="foreach: topologies">
                        <div class="ticket">
                            <div class="ticket-inner">
                                <div class="pull-right">
                                    <!-- Enabled/disabled badge -->
                                    <span class="badge badge-green" data-bind="visible: enabled()==true">Enabled</span>
                                    <span class="badge " data-bind="visible: enabled()==false">Disabled</span>
                                    <!--Status badge-->
                                    <span class="badge badge-green" data-bind="visible: status()=='running'">Running</span>
                                    <span class="badge badge-red" data-bind="visible: status()=='error'">Error</span>
                                    <span class="badge" data-bind="visible: status()=='unassigned'">Unassigned</span>
                                    <span class="badge badge-orange" data-bind="visible: status()=='waiting'">Waiting</span>
                                </div>
                                <label data-bind="text: uuid()"></label>
                                <div>
                                    worker: <span data-bind="text: worker()"></span>
                                </div>
                                <div class="right">
                                    <a data-bind="click: open">More &raquo;</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="cell-3">
            <div class="panel">
                <div class="panel-header">
                    <div class="title">Coordination storage</div>
                </div>
                <div class="panel-body props">
                    <div data-bind="foreach: storage_props">
                        <dt data-bind="text: key"></dt>
                        <dd data-bind="text: value"></dd>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script language="javascript" type="text/javascript">
    $(function () {
        var model = new QTopologyDashboardViewModel();
        ko.applyBindings(model);
        model.init();
    });

</script>

</html>
